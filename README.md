# DIFF

## 流程

1. 先定义一个虚拟dom元素的类，包含了类型，属性，子元素这些属性
2. createElement 创建虚拟dom元素，返回实例化的虚拟dom对象
3. render 将虚拟dom转化为真实的浏览器里用的真实dom，主要用到了createElement，createTextNode,appendChild,递归转化子元素
4. renderDom 将创建好的真实dom渲染挂在页面上的元素上
5. diff dom改变，比较两颗虚拟树的差异，得到补丁
   1. patches 一个对象，包含每个元素的变化： {0: { }, 1: { }, 2: { }, ...}
   2. walk 深度遍历比较新旧dom上的每一个结点，收集补丁
      1. changes 当前结点上的变化列表
      2. 如果不存在新节点，表示删除
      3. 如果是文本，表示文本根性
      4. 如果是标签并且是同类，
         1. diffAttr 进行属性比较并得出变化的属性对象
         2. diffChildren 如果有子节点，那就进入下一层递归
            1. 下一层是由若干个并列子元素的数组，循环分别深度遍历
      5. 如果是不同标签元素，那就表示替换
         1. diffChildren 如果有子节点，那就进入下一层递归
6. patch 递归把补丁应用到真实dom上

## diff作用

- 比较两个虚拟dom的差别
- 根据两个虚拟对象，创建出补丁（描述改变的内容），并将补丁更新到dom里

## 三种优化策略

- 平级比较 type props children
- 跨级
- key 交换位置

## 差异计算

- 先序深度优先遍历
